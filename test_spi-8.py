#!/usr/bin/env python3
"""
================================================================================
–ü—Ä–æ–µ–∫—Ç: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ LoRa-–º–æ–¥—É–ª–µ–º SX1262 –Ω–∞–ø—Ä—è–º—É—é –∏–∑ Linux —á–µ—Ä–µ–∑ FTDI (SPI)
================================================================================

–û–ø–∏—Å–∞–Ω–∏–µ:
–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç bare-metal —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–¥–∏–æ—á–∏–ø–æ–º Semtech SX1262 
–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ (userspace) Linux. –ú—ã –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ —á–∏–ø—É "—Å—ã—Ä—ã–º–∏" 
–±–∞–π—Ç–∞–º–∏ –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É SPI, –∏—Å–ø–æ–ª—å–∑—É—è USB-–∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä –Ω–∞ –±–∞–∑–µ —á–∏–ø–∞ FT232H –∏ 
–±–∏–±–ª–∏–æ—Ç–µ–∫—É pyftdi (—á–µ—Ä–µ–∑ libusb). 

–°–∫—Ä–∏–ø—Ç —ç–º—É–ª–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞: –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç RF-—Å–≤–∏—Ç—á–æ–º, 
–æ–∂–∏–¥–∞–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —á–∏–ø–∞ (–ø–∏–Ω BUSY) –∏ –æ—Ç–ª–∞–≤–ª–∏–≤–∞–µ—Ç –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ 
—É—Å–ø–µ—à–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –ø–∞–∫–µ—Ç–∞ (TxDone) —á–µ—Ä–µ–∑ –ø–∏–Ω DIO1.

–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ:
- USB-to-SPI –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä: –ª—é–±–æ–π –º–æ–¥—É–ª—å –Ω–∞ –±–∞–∑–µ —á–∏–ø–∞ FTDI FT232H.
- LoRa –º–æ–¥—É–ª—å: Seeed Studio SX1262 (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π).
  * –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ö–æ–¥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø–æ–¥ –º–æ–¥—É–ª–∏ —Å –ø–∏—Ç–∞–Ω–∏–µ–º TCXO 1.7V –∏ 
    –æ–¥–Ω–æ–ø–∏–Ω–æ–≤—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∞–Ω—Ç–µ–Ω–Ω—ã–º –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä–æ–º (RF Switch).

–†–∞—Å–ø–∏–Ω–æ–≤–∫–∞ (FT232H -> SX1262):
- AD0 (SCK)   -> SCK
- AD1 (MOSI)  -> MOSI
- AD2 (MISO)  -> MISO
- AD3 (CS)    -> NSS (Chip Select)
- AD4 (–í—Ö–æ–¥)  -> BUSY (–§–ª–∞–≥ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ —á–∏–ø–∞)
- AD5 (–í—ã—Ö–æ–¥) -> RF_SW / TXEN (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–Ω—Ç–µ–Ω–Ω–æ–π: HIGH=TX, LOW=RX)
- AD6 (–í—Ö–æ–¥)  -> DIO1 (–ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è, –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ TxDone)
- GND         -> GND
- 3.3V        -> VCC

–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
    pip3 install pyftdi

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:
–£–∑–Ω–∞–π—Ç–µ URI –≤–∞—à–µ–≥–æ FTDI-–∞–¥–∞–ø—Ç–µ—Ä–∞ –∫–æ–º–∞–Ω–¥–æ–π `ftdi_urls.py` –∏ –≤–ø–∏—à–∏—Ç–µ –µ–≥–æ –Ω–∏–∂–µ.
================================================================================
"""

import time
from pyftdi.spi import SpiController

# ==========================================
# 1. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø SPI –ò GPIO
# ==========================================
spi = SpiController()

# –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –ø–µ—Ä–≤–æ–º—É –Ω–∞–π–¥–µ–Ω–Ω–æ–º—É —á–∏–ø—É FT232H. 
# –ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤, —É–∫–∞–∂–∏—Ç–µ —Ç–æ—á–Ω—ã–π URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: 'ftdi://ftdi:232h:1:29/1')
spi.configure('ftdi://ftdi:232h/1')

# –í—ã–±–∏—Ä–∞–µ–º –ø–∏–Ω CS (AD3 = 0), —á–∞—Å—Ç–æ—Ç—É 1 –ú–ì—Ü –∏ —Ä–µ–∂–∏–º SPI 0
slave = spi.get_port(cs=0, freq=1E6, mode=0)
gpio = spi.get_gpio()

# –ú–∞—Å–∫–∏ –ø–∏–Ω–æ–≤ –¥–ª—è –ø–æ—Ä—Ç–∞ ADBUS —á–∏–ø–∞ FT232H
BUSY_PIN = 0x10  # AD4 (–ë–∏—Ç 4)
RFSW_PIN = 0x20  # AD5 (–ë–∏—Ç 5)
DIO1_PIN = 0x40  # AD6 (–ë–∏—Ç 6)

# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è: AD4 –∏ AD6 - –≤—Ö–æ–¥—ã (0), AD5 - –≤—ã—Ö–æ–¥ (1)
gpio.set_direction(BUSY_PIN | RFSW_PIN | DIO1_PIN, RFSW_PIN)

# –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–µ—Ä–µ–≤–æ–¥–∏–º –∞–Ω—Ç–µ–Ω–Ω—ã–π –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä –≤ —Ä–µ–∂–∏–º –ø—Ä–∏–µ–º–∞ (LOW)
gpio.write(gpio.read() & ~RFSW_PIN)

print("SPI –∏ GPIO –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã.\n")


# ==========================================
# 2. –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
# ==========================================
def wait_for_busy():
    """–ë–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –ø–æ–∫–∞ —á–∏–ø SX1262 –∑–∞–Ω—è—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ (BUSY == HIGH)"""
    while (gpio.read() & BUSY_PIN):
        pass

def send_cmd(cmd_name, cmd_bytes):
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –±–∞–π—Ç—ã –∫–æ–º–∞–Ω–¥—ã –ø–æ SPI, –¥–æ–∂–¥–∞–≤—à–∏—Å—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —á–∏–ø–∞.
    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç—É—Å-–±–∞–π—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —á–∏–ø–æ–º.
    """
    wait_for_busy()
    response = slave.exchange(cmd_bytes, duplex=True)
    
    # SX1262 –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–≤–æ–π —Å—Ç–∞—Ç—É—Å –≤ —Å–∞–º–æ–º –ø–µ—Ä–≤–æ–º –±–∞–π—Ç–µ –æ—Ç–≤–µ—Ç–∞
    status_byte = response[0]
    cmd_status = (status_byte >> 1) & 0x07  # –ò–∑–≤–ª–µ–∫–∞–µ–º –±–∏—Ç—ã [3:1]
    
    # –ö–æ–¥—ã: 4 (–û—à–∏–±–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤), 5 (–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤ —Ç–µ–∫—É—â–µ–º —Ä–µ–∂–∏–º–µ)
    if cmd_status in [0x04, 0x05]:
        print(f"‚ùå –û–®–ò–ë–ö–ê –ø–µ—Ä–µ–¥ '{cmd_name}' (–ö–æ–¥ —Å—Ç–∞—Ç—É—Å–∞: {cmd_status})")
    else:
        print(f"‚úÖ {cmd_name}")
    return response

def check_aliveness():
    """–¢–µ—Å—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (MISO/MOSI) –ø—É—Ç–µ–º –∑–∞–ø–∏—Å–∏ –∏ —á—Ç–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞ SyncWord"""
    send_cmd("WriteRegister (–¢–µ—Å—Ç SPI)", [0x0D, 0x07, 0x40, 0x24, 0xB4])
    resp = send_cmd("ReadRegister", [0x1D, 0x07, 0x40, 0x00, 0x00, 0x00])
    read_val = (resp[-2] << 8) | resp[-1]
    
    if read_val != 0x24B4:
        print(f"‚ùå –°–ë–û–ô SPI! –û–∂–∏–¥–∞–ª–∏ 0x24b4, –ø–æ–ª—É—á–∏–ª–∏ {hex(read_val)}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ–≤–æ–¥–∞!")
        exit(1)
    else:
        print("‚úÖ –ú–æ–¥–µ–º –ñ–ò–í! SPI —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.")

def check_device_errors():
    """–ß—Ç–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã—Ö –æ—à–∏–±–æ–∫ (Opcode 0x17)"""
    resp = send_cmd("GetDeviceErrors", [0x17, 0x00, 0x00])
    
    # –°–æ–±–∏—Ä–∞–µ–º 2 –±–∞–π—Ç–∞ –æ—Ç–≤–µ—Ç–∞.
    # –£ SX1262 —Ñ–ª–∞–≥–∏ –æ—à–∏–±–æ–∫ –∑–∞–Ω–∏–º–∞—é—Ç —Ç–æ–ª—å–∫–æ –º–ª–∞–¥—à–∏–µ 9 –±–∏—Ç (–±–∏—Ç—ã 0-8).
    # –ù–∞–∫–ª–∞–¥—ã–≤–∞–µ–º –º–∞—Å–∫—É 0x01FF, —á—Ç–æ–±—ã –æ—Ç—Å–µ—á—å —Ñ–∞–Ω—Ç–æ–º–Ω—ã–π –º—É—Å–æ—Ä –æ—Ç —à–∏–Ω—ã SPI 
    # (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–∑–∞—Å—Ç—Ä—è–≤—à–∏–π" –±–∞–π—Ç —Å—Ç–∞—Ç—É—Å–∞ 0xA2 –≤ —Å—Ç–∞—Ä—à–µ–º –±–∞–π—Ç–µ).
    error_mask = ((resp[1] << 8) | resp[2]) & 0x01FF
    
    if error_mask != 0:
        print(f"‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï! –†–µ–∞–ª—å–Ω–∞—è –∞–ø–ø–∞—Ä–∞—Ç–Ω–∞—è –æ—à–∏–±–∫–∞: {hex(error_mask)}")
        send_cmd("ClearDeviceErrors", [0x07, 0x00, 0x00])


def enable_tx_path(enable):
    """–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ RF-—Å–≤–∏—Ç—á–∞ –±–µ–∑ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–Ω–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∏–Ω–æ–≤"""
    current_state = gpio.read()
    output_state = current_state & RFSW_PIN 
    if enable:
        gpio.write(output_state | RFSW_PIN)
    else:
        gpio.write(output_state & ~RFSW_PIN)

def send_packet(payload_str):
    """–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –±—É—Ñ–µ—Ä–∞, –≤–∫–ª—é—á–µ–Ω–∏–µ –∞–Ω—Ç–µ–Ω–Ω—ã –∏ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–µ–¥–∞—á–∏"""
    payload_bytes = [ord(c) for c in payload_str]
    
    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –¥–ª–∏–Ω—É –ø–∞–∫–µ—Ç–∞ –≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ö (Preamble=16, CRC=Off)
    send_cmd(f"SetPacketParams (Len={len(payload_bytes)})", 
             [0x8C, 0x00, 0x10, 0x00, len(payload_bytes), 0x00, 0x00])
    
    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –ø–æ–ª–µ–∑–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É –≤ –±—É—Ñ–µ—Ä –ø–µ—Ä–µ–¥–∞—á–∏
    send_cmd("SetBufferBaseAddress", [0x8F, 0x00, 0x00])
    send_cmd(f"WriteBuffer ('{payload_str}')", [0x0E, 0x00] + payload_bytes)
    
    # –§–∏–∑–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∞–Ω—Ç–µ–Ω–Ω—É –Ω–∞ —É—Å–∏–ª–∏—Ç–µ–ª—å –º–æ—â–Ω–æ—Å—Ç–∏
    enable_tx_path(True)
    
    # –î–∞–µ–º –∫–æ–º–∞–Ω–¥—É –Ω–∞ —Å—Ç–∞—Ä—Ç –ø–µ—Ä–µ–¥–∞—á–∏
    send_cmd("SetTx", [0x83, 0x00, 0x00, 0x00])
    
    # –û–∂–∏–¥–∞–µ–º –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–≥–æ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è TxDone –Ω–∞ –ø–∏–Ω–µ DIO1
    start_time = time.time()
    tx_success = False
    while True:
        if gpio.read() & DIO1_PIN:
            tx_success = True
            break
        if time.time() - start_time > 2.0:  # –¢–∞–π–º–∞—É—Ç 2 —Å–µ–∫—É–Ω–¥—ã
            break
            
    if tx_success:
        print(f"üéâ –ü–∞–∫–µ—Ç '{payload_str}' —É—Å–ø–µ—à–Ω–æ —É–ª–µ—Ç–µ–ª –≤ —ç—Ñ–∏—Ä!")
    else:
        print("‚ùå –¢–ê–ô–ú–ê–£–¢ –æ—Ç–ø—Ä–∞–≤–∫–∏ (–ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ TxDone –Ω–µ –ø–æ–ª—É—á–µ–Ω–æ).")
        check_device_errors()

    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∞–Ω—Ç–µ–Ω–Ω—É –≤ —Ä–µ–∂–∏–º –ø—Ä–∏–µ–º–∞ –∏ –æ—á–∏—â–∞–µ–º —Ñ–ª–∞–≥–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π
    enable_tx_path(False)
    send_cmd("ClearIrqStatus", [0x02, 0xFF, 0xFF])


# ==========================================
# 3. –ù–ê–°–¢–†–û–ô–ö–ê SX1262
# ==========================================
print("--- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ ---")
send_cmd("SetStandby", [0x80, 0x00])
check_aliveness()
check_device_errors()

print("\n--- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–¥–∏–æ-—Ç—Ä–∞–∫—Ç–∞ ---")
# –ò—Å–ø–æ–ª—å–∑—É–µ–º DC-DC –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä (–±–æ–ª–µ–µ —ç–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π, —á–µ–º LDO)
send_cmd("SetRegulatorMode (DC-DC)", [0x96, 0x01])

# –í–∫–ª—é—á–∞–µ–º –ø–∏—Ç–∞–Ω–∏–µ –¥–ª—è –∫–≤–∞—Ä—Ü–∞ —Å —Ç–µ—Ä–º–æ–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–µ–π (TCXO) –Ω–∞ 1.7 –í–æ–ª—å—Ç–∞
send_cmd("SetDio3AsTcxoCtrl (1.7V)", [0x97, 0x02, 0x00, 0x02, 0x80])

# –í—ã–ø–æ–ª–Ω—è–µ–º –∫–∞–ª–∏–±—Ä–æ–≤–∫—É RC-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞, PLL –∏ —Ñ–∏–ª—å—Ç—Ä–∞ (Image Rejection) –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞ 900 –ú–ì—Ü
send_cmd("Calibrate (RC –∏ PLL)", [0x89, 0x7F])
send_cmd("CalibrateImage (900 MHz)", [0x98, 0xE1, 0xE9])

send_cmd("SetPacketType (LoRa)", [0x8A, 0x01])

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á–∞—Å—Ç–æ—Ç—É 906.875 MHz (0x38ADEA00 –≤ —à–∞–≥–∞—Ö PLL)
send_cmd("SetRfFrequency (906.875 MHz)", [0x86, 0x38, 0xAD, 0xEA, 0x00])

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É—Å–∏–ª–∏—Ç–µ–ª—è –º–æ—â–Ω–æ—Å—Ç–∏. 
# –ò—Å–ø–æ–ª—å–∑—É–µ–º 0 dBm –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –Ω–∞ —Å—Ç–æ–ª–µ, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–µ–º–Ω–∏–∫ (Max: 22 dBm)
send_cmd("SetPaConfig (Optimal)", [0x95, 0x04, 0x07, 0x00, 0x01])
send_cmd("SetTxParams (0 dBm)", [0x8E, 0x00, 0x04])

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥—É–ª—è—Ü–∏–∏: Spreading Factor 11, Bandwidth 250 kHz, Coding Rate 4/5
send_cmd("SetModulationParams (SF11, 250kHz, CR4/5)", [0x8B, 0x0B, 0x05, 0x01, 0x00])

# –ù–∞–ø—Ä–∞–≤–ª—è–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ TxDone (–ë–∏—Ç 0) –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –ø–∏–Ω DIO1
send_cmd("SetDioIrqParams", [0x08, 0x00, 0x01, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00])
send_cmd("ClearIrqStatus", [0x02, 0xFF, 0xFF])


# ==========================================
# 4. –ù–ê–°–¢–†–û–ô–ö–ê –°–ò–ù–•–†–û-–°–õ–û–í–ê –ò –û–¢–ü–†–ê–í–ö–ê
# ==========================================
print("\n--- –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö ---")

"""
–ü–û–ß–ï–ú–£ –ú–´ –ò–°–ü–û–õ–¨–ó–£–ï–ú 0x24B4 –î–õ–Ø –°–ò–ù–•–†–û-–°–õ–û–í–ê 0x2B?
–í —Å—Ç–∞—Ä—ã—Ö —á–∏–ø–∞—Ö (SX127x) —Ä–µ–≥–∏—Å—Ç—Ä SyncWord –∑–∞–Ω–∏–º–∞–ª 1 –±–∞–π—Ç. –ú–Ω–æ–≥–∏–µ –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ
–±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (RadioLib, Arduino-LoRa, MicroPython) —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ —ç—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0x2b)
–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

–í —á–∏–ø–∞—Ö —Å–µ—Ä–∏–∏ SX126x —Ä–µ–≥–∏—Å—Ç—Ä SyncWord –¥–≤—É—Ö–±–∞–π—Ç–æ–≤—ã–π. –ß—Ç–æ–±—ã "—Å–æ—Å—Ç—ã–∫–æ–≤–∞—Ç—å" —Ñ–æ—Ä–º–∞—Ç—ã,
–±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ω–µ–∑–∞–º–µ—Ç–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–∞–∑–±–∏–≤–∞—é—Ç 1 –±–∞–π—Ç –Ω–∞ –ø–æ–ª—É–±–∞–π—Ç—ã –∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç 
–º–∞—Å–∫—É Semtech `0xY4Z4`.
–ü—Ä–∏–º–µ—Ä –¥–ª—è 0x2B: 
  1. –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ '2' –∏ 'B'.
  2. –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –≤ –º–∞—Å–∫—É: 0x(2)4(B)4.
  3. –ò—Ç–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: 0x24B4.

–ü–æ—Å–∫–æ–ª—å–∫—É –º—ã –æ–±—â–∞–µ–º—Å—è —Å —á–∏–ø–æ–º —Å—ã—Ä—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏, –º—ã –¥–æ–ª–∂–Ω—ã –≤—Ä—É—á–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
—É–∂–µ —Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ 2-–±–∞–π—Ç–æ–≤–æ–µ —Å–ª–æ–≤–æ –ø–æ –∞–¥—Ä–µ—Å–∞–º 0x0740 –∏ 0x0741.
"""
send_cmd("WriteRegister SyncWord (0x24B4)", [0x0D, 0x07, 0x40, 0x24, 0xB4])

# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –ø–∞–∫–µ—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å –ø—Ä–∏–µ–º–Ω–∏–∫
send_packet("PING 123")

# –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–µ—Å—Å–∏—é libusb
spi.terminate()
print("\n–°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞.")
